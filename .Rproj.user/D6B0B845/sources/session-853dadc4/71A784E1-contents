---
title: "Dendro"
output: html_document
date: "2024-09-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Library
```{r}
#install.packages("dplR")
library(dplR)
```

Read collections
```{r}
Childs <- read.tucson("ChildsCol1.rwl")
Sheep <- read.tucson("SheepCol1.rwl")
UB <- read.tucson("UBCol1.rwl")
LB <- read.tucson("LBCol1.rwl")

ALL <- read.tucson("All.rwl")
ALLCor <- read.tucson("AllCorrelated.rwl")
```

Summary RWL

```{r}
rwl.report(ALLCor)
rwl.report(ALL)

spag.plot(ALLCor)
```

Nondetrend

```{r}
AllNoDetrend <- chron(ALL)
AllCorNoDetrend <- chron(ALLCor)

plot.crn(AllNoDetrend)
plot.crn(AllCorNoDetrend)
```


Detrend
```{r}
Childs <- detrend( rwl = Childs, method = "AgeDepSpline")
Sheep <- detrend( rwl = Sheep, method = "AgeDepSpline")
UB <- detrend(rwl= UB, method = "AgeDepSpline")
LB <- detrend(rwl = LB, method = "AgeDepSpline")
ALL <- detrend(rwl = ALL, method = "AgeDepSpline")
ALLCor <- detrend(rwl= ALLCor, method = "AgeDepSpline")
```

Turn into Chronology
```{r}
Childscrn <- chron(Childs)
Sheepcrn <- chron(Sheep)
UBcrn <- chron(UB)
LBcrn <- chron(LB)
Allcrn <- chron(ALL)
AllCorcrn <- chron(ALLCor)

```


RWI Plots
```{r}
plot.crn(Sheepcrn, add.spline = TRUE, nyears = 5)
plot.crn(UBcrn, add.spline = TRUE, nyears = 5)
plot.crn(LBcrn, add.spline = TRUE, nyears = 5)

plot.crn(Childscrn, add.spline = TRUE, nyears = 5)

plot.crn(AllCorcrn, add.spline = TRUE, nyears = 5)
plot.crn(Allcrn, add.spline = TRUE, nyears = 5)

```

add year
```{r}
Sheepcrn$Year <- seq(1988, by = 1, length.out = nrow(Sheepcrn))
Childscrn$Year <- seq(1993, by = 1, length.out = nrow(Childscrn))
UBcrn$Year <- seq(1994, by= 1, length.out= nrow(UBcrn))
LBcrn$Year <- seq(1994, by= 1, length.out = nrow(LBcrn))
Allcrn$Year <- seq(1988, by = 1, length.out = nrow(Allcrn))

```

RWI ALL plot
```{r}

# Combine all datasets into one
Sheepcrn$Dataset <- "Sheep Bridge"
Childscrn$Dataset <- "Childs"
UBcrn$Dataset <- "Upper Beasley"
LBcrn$Dataset <- "Lower Beasley"
Allcrn$Dataset <- "All"

# Combine datasets
combined_data <- rbind(Sheepcrn, Childscrn, UBcrn, LBcrn, Allcrn)

# Create the ggplot with legend
ggplot(combined_data, aes(x = Year, y = std, color = Dataset, linetype = Dataset)) +
  geom_line(size = .5) +  # Line thickness
  labs(x = "Year", y = "Standard Deviation", title = "Multiple Line Graphs") +
  scale_color_manual(values = c("Sheep Bridge" = "lightgreen", 
                                 "Childs" = "red", 
                                 "Upper Beasley" = "blue", 
                                 "Lower Beasley" = "orange",
                                "All" = "black")) +  # Custom colors
    geom_hline(yintercept = 1, linetype= "dashed", color = "black")+

  theme_minimal() +
  theme(legend.title = element_blank())  # Optionally remove legend title

```



Basal Area Index

```{r}
AllBAI <- bai.in(ALL, d2pith = NULL)
AllBAIchrn <- chron(AllBAI)
plot.crn(AllBAIchrn)

AllCorBAI <- bai.in(ALLCor, d2pith = NULL)
AllCorBAIchrn <- chron(AllCorBAI)
plot.crn(AllCorBAIchrn)

ChildsBAI <- bai.in(Childs, d2pith = NULL)
ChildsBAIchrn <- chron(ChildsBAI)
plot.crn(ChildsBAIchrn)

SheepBAI <- bai.in(Sheep, d2pith = NULL)
SheepBAIchrn <- chron(SheepBAI)
plot.crn(SheepBAIchrn)

UBBAI <- bai.in(UB, d2pith = NULL)
UBBAIchrn <- chron(UBBAI)
plot.crn(UBBAIchrn)

LBBAI <- bai.in(LB, d2pith = NULL)
LBBAIchrn <- chron(LBBAI)
plot.crn(LBBAIchrn)


```

add year to BAI chrn
```{r}
SheepBAIchrn$Year <- seq(1988, by = 1, length.out = nrow(Sheepcrn))
ChildsBAIchrn$Year <- seq(1993, by = 1, length.out = nrow(Childscrn))
UBBAIchrn$Year <- seq(1994, by= 1, length.out= nrow(UBcrn))
LBBAIchrn$Year <- seq(1994, by= 1, length.out = nrow(LBcrn))
AllBAIchrn$Year <- seq(1988, by = 1 , length.out = nrow(AllBAIchrn))
```

All bai plot

```{r}
# Combine all datasets into one
SheepBAIchrn$Dataset <- "Sheep Bridge"
ChildsBAIchrn$Dataset <- "Childs"
UBBAIchrn$Dataset <- "Upper Beasley"
LBBAIchrn$Dataset <- "Lower Beasley"
AllBAIchrn$Dataset <- "All"

# Combine datasets
combinedBAI_data <- rbind(SheepBAIchrn, ChildsBAIchrn, UBBAIchrn, LBBAIchrn, AllBAIchrn)

# Create the ggplot with legend
ggplot(combinedBAI_data, aes(x = Year, y = std, color = Dataset, linetype = Dataset)) +
  geom_line(size = .5) +  # Line thickness
  labs(x = "Year", y = "Standard Deviation", title = "Multiple Line Graphs") +
  scale_color_manual(values = c("Sheep Bridge" = "lightgreen", 
                                 "Childs" = "red", 
                                 "Upper Beasley" = "blue", 
                                 "Lower Beasley" = "orange",
                                "All" = "black")) +  # Custom colors
  theme_minimal() +
  theme(legend.title = element_blank())  # Optionally remove legend title
```




```{r}
COFECHA

```{r}
#XDatr/Cofecha

Childsseg <- corr.rwl.seg(Childs, seg.length = 6, pcrit= .1)
Sheepseg <- corr.rwl.seg(Sheep, seg.length = 6, pcrit = .1)
UBSeg <- corr.rwl.seg(UB, seg.length = 6,pcrit = .1)
LBSeg <-corr.rwl.seg(LB,seg.length = 6, pcrit = .1)
AllSeg <-corr.rwl.seg(ALL,seg.length = 6, pcrit = .1)

#Blue = well correlated to the master chronology
#Red = poorly correlated to the master chronology
#Green = not enough overlap


corr.series.seg(rwl = All, series = "C32", seg.length = 10)


ccf.series.rwl(rwl = Childs, series = "C32", seg.length = 10)

```





